Milestone: Correct Service Monitoring Logic (Unity App Visibility + MDM Separation)
Summary

Right now, devices report accurate MDM agent data under agent.version, but the â€œServiceâ€ monitoring field (unity) is incorrectly pulling that same agent version.
We need to separate these two data sources so:

The MDM agent continues reporting its own version and health (agent.version = 1.0.161-426db70).

The Unity app (io.unitynodes.unityapp) is actively monitored and reflected under the unity field, with its own version and running status.

This ensures the dashboard shows:

Agent â†’ MDM version (NextMDM)
Service â†’ Unity app + version + running status

âš™ï¸ Scope of Work
1. Backend â€” Telemetry Logic

 In the device heartbeat or monitoring routine (likely monitoring.py or telemetry_worker.py):

Continue collecting MDM agent info under the agent field (no changes).

Add a separate app inspection for the Unity app package (io.unitynodes.unityapp).

Capture:

Package name

Version name / version code

Foreground or background state

Running status (using pm list packages, dumpsys activity or existing service ping)

 Store this data under the unity key in the JSON payload:

"unity": {
  "package": "io.unitynodes.unityapp",
  "version": "0.1.1",
  "status": "running"
}


 If Unity app is not found or inactive, report:

"unity": {
  "status": "not_installed" | "inactive"
}

2. Dashboard â€” Display Logic

 Device table:

Keep Agent column showing MDM version (unchanged).

Keep Service column tied to Unity app status.

If running â†’ Unity (Running) with green badge

If inactive â†’ gray â€œIdleâ€ or â€œNot runningâ€ tag

If missing â†’ red â€œNot installedâ€

 Device Details Drawer:

next MDM Version â†’ continues showing agent version

Monitored Service â†’ Unity

Unity Version (from unity.version)

Unity Status (from unity.status)

 Ensure settings.monitored_package (currently io.unitynodes.unityapp) is what drives this lookup globally, so you can later change it for other services if needed.

3. Data Flow Example

Before (current):

"agent": { "version": "1.0.161-426db70" },
"unity": { "version": "1.0.161-426db70", "status": "running" }


After (fixed):

"agent": { "version": "1.0.161-426db70" },
"unity": { "package": "io.unitynodes.unityapp", "version": "0.1.1", "status": "running" }

âœ… Deliverables

agent.version continues to reflect Next MDM version.

unity reflects Unity appâ€™s actual package, version, and running status.

Dashboard shows â€œUnity (Running)â€ under Service column, even when MDM version differs.

â€œUnknownâ€ only appears when the monitored package is not installed or not responding.

Global monitoring defaults apply to new devices.

ğŸš« Do Not Change

âŒ Do not modify agent version logic or heartbeat payload structure for agent.

âŒ Do not rename existing DB fields or add migrations.

âŒ Do not change global monitoring setting schema (just use it).

âŒ Do not touch unrelated dashboards (Battery, Network, Alerts, etc.).